---
import GlobalCallToAction from "./GlobalCallToAction.astro";
import type { BrandConfig } from "../brands";
import { mobileTiresBrand } from "../brands";

const { brand = mobileTiresBrand } = Astro.props as { brand?: BrandConfig };
---

<section class="relative py-24 bg-white overflow-hidden">
  <!-- Background Glow Effect (Subtle) -->
  <div
    class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-full max-w-7xl pointer-events-none z-0"
  >
    <div
      class="absolute top-[20%] left-[10%] w-96 h-96 bg-[var(--color-queens-secondary)]/10 rounded-full blur-3xl mix-blend-multiply filter opacity-70 animate-blob"
    >
    </div>
    <div
      class="absolute top-[20%] right-[10%] w-96 h-96 bg-[var(--color-queens-light)]/10 rounded-full blur-3xl mix-blend-multiply filter opacity-70 animate-blob animation-delay-2000"
    >
    </div>
  </div>

  <div class="container relative z-10 mx-auto px-6 max-w-5xl text-center">
    <!-- Badge (Optional, mimics the '100K+ tasks' pill) -->
    <div
      class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-[var(--color-queens-secondary)]/10 border border-[var(--color-queens-secondary)]/20 mb-8"
    >
      <span class="w-2 h-2 rounded-full bg-[var(--color-queens-secondary)]"
      ></span>
      <span
        class="text-sm font-medium text-[var(--color-queens-primary)]/70 font-sans"
        >Northern Illinois' Premier Mobile Service</span
      >
    </div>

    <!-- Headline -->
    <h1
      class="text-5xl md:text-7xl font-sans font-normal tracking-tighter text-[var(--color-queens-primary)] mb-8 leading-[1.1]"
    >
      We Bring The <br />
      <span class="font-serif italic text-queens-secondary">Tire Shop</span> To You
    </h1>

    <!-- Subheadline -->
    <p
      class="text-xl md:text-2xl text-[var(--color-queens-primary)]/60 mb-12 max-w-2xl mx-auto leading-relaxed font-sans font-light"
    >
      Skip the waiting room. We deliver and install your new tires at home or
      work.
    </p>

    <!-- Audio Player (City Page Style) -->
    <div
      class="max-w-md mx-auto mb-20 text-left"
      x-data="{ playing: false, audio: null, progress: 0, currentTime: '00:00' }"
      x-init="
        audio = $refs.audioPlayer;
        audio.addEventListener('timeupdate', () => {
          progress = (audio.currentTime / audio.duration) * 100;
          let min = Math.floor(audio.currentTime / 60);
          let sec = Math.floor(audio.currentTime % 60);
          currentTime = (min < 10 ? '0' : '') + min + ':' + (sec < 10 ? '0' : '') + sec;
        });
        audio.addEventListener('ended', () => { playing = false; progress = 0; currentTime = '00:00'; });
      "
    >
      <p
        class="text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest mb-4 pl-4"
      >
        Message from our team
      </p>

      <div
        class="bg-gray-50 dark:bg-slate-800 rounded-2xl p-4 flex items-center gap-4 border border-gray-100 dark:border-slate-700 shadow-sm"
      >
        <audio
          x-ref="audioPlayer"
          src="/assets/audio/welcome-message.mp3"
          preload="metadata"
          class="hidden"></audio>

        <!-- Play Button -->
        <button
          @click="playing ? audio.pause() : audio.play(); playing = !playing"
          class="w-12 h-12 flex-shrink-0 flex items-center justify-center rounded-full bg-queens-primary text-white hover:bg-queens-secondary transition-all duration-300 shadow-md hover:shadow-lg hover:scale-105"
          aria-label="Play Audio Message"
        >
          <template x-if="!playing">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="w-5 h-5 ml-0.5"
            >
              <path
                fill-rule="evenodd"
                d="M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.348c1.295.712 1.295 2.573 0 3.285L7.28 19.991c-1.25.687-2.779-.217-2.779-1.643V5.653z"
                clip-rule="evenodd"></path>
            </svg>
          </template>
          <template x-if="playing">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="w-5 h-5"
            >
              <path
                fill-rule="evenodd"
                d="M6.75 5.25a.75.75 0 01.75-.75H9a.75.75 0 01.75.75v13.5a.75.75 0 01-.75.75H7.5a.75.75 0 01-.75-.75V5.25zm7.5 0A.75.75 0 0115 4.5h1.5a.75.75 0 01.75.75v13.5a.75.75 0 01-.75.75H15a.75.75 0 01-.75-.75V5.25z"
                clip-rule="evenodd"></path>
            </svg>
          </template>
        </button>

        <!-- Progress -->
        <div class="flex-grow">
          <div
            class="flex justify-between text-[10px] font-bold text-gray-400 dark:text-gray-500 mb-2 uppercase tracking-wider"
          >
            <span>Listen</span>
            <span x-text="currentTime">00:00</span>
          </div>
          <div
            class="h-1.5 bg-gray-200 dark:bg-slate-700 rounded-full overflow-hidden cursor-pointer relative"
            @click="let rect = $el.getBoundingClientRect(); let x = $event.clientX - rect.left; let percent = x / rect.width; audio.currentTime = percent * audio.duration;"
          >
            <div
              class="absolute top-0 left-0 h-full bg-queens-secondary transition-all duration-100"
              :style="`width: ${progress}%`"
            >
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- CTA Button -->
    <div class="mt-[-2rem] mb-12 relative z-20 flex justify-center">
      <GlobalCallToAction brand={brand} />
    </div>
  </div>
</section>

<!-- Alpine.js (if not loaded) -->
<script>
  import Alpine from "alpinejs";

  if (!window.Alpine) {
    window.Alpine = Alpine;
    Alpine.start();
  }
</script>

<style></style>
