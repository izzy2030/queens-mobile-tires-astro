---
import BaseLayout from "../../layouts/BaseLayout.astro";
import CityCTA from "../../components/CityCTA.astro";
import CityReviews from "../../components/CityReviews.astro";

// 1. FETCH ALL CITIES & GENERATE PATHS
import cities from "../../data/cities.json";

export async function getStaticPaths() {
  return cities.map((city) => ({
    params: { slug: city.slug },
    props: { city },
  }));
}

// 2. PAGE TEMPLATE
const { city } = Astro.props;
const acf = (city as any).cityFields;

// Helper to clean city name (e.g. "Mobile Tire Service in Elgin, IL" -> "Elgin")
const cityName = city.title
  .replace("Mobile Tire Service in ", "")
  .replace(", IL", "");
---

<BaseLayout title={`${acf.localTitle || city.title} | Queens Mobile Tires`}>
  <!-- HERO SECTION: Preserving the Original "Split" Design -->
  <section class="relative py-20 lg:py-32 bg-white overflow-hidden">
    <div class="container mx-auto px-6 max-w-7xl">
      <div class="grid md:grid-cols-2 gap-12 lg:gap-20 items-center">
        <!-- Left: Text Content -->
        <div class="relative z-10 text-left order-2 lg:order-1">
          <!-- Eyebrow Badge -->
          <div
            class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-queens-secondary/10 border border-queens-secondary/20 mb-8"
          >
            <span class="w-2 h-2 rounded-full bg-queens-secondary"></span>
            <span class="text-sm font-medium text-queens-primary/70 font-sans">
              Serving {cityName}, IL
            </span>
          </div>

          <h1
            class="text-4xl md:text-6xl font-sans font-normal tracking-tighter text-queens-primary mb-8 leading-[1.1]"
          >
            Mobile Tire Service <br /> in <span
              class="font-serif italic text-queens-secondary"
              >{cityName}, IL</span
            >
          </h1>

          <h3
            class="text-xl md:text-2xl text-queens-primary/60 mb-6 leading-relaxed font-sans font-light"
          >
            We bring the tire shop to your driveway or office in {cityName}.
          </h3>

          <!-- New Copy from HTML Sample -->
          <p class="text-xl text-gray-600 mb-8 leading-relaxed">
            {
              acf.introText ||
                `Stuck on the road? Flat in your driveway? We come to you in ${cityName} ‚Äî same-day service, 7 days a week.`
            }
          </p>

          <div class="flex flex-wrap gap-4 items-center">
            <a
              href="/buy-new-tires"
              data-astro-reload
              class="btn-primary shadow-2xl hover:scale-105 transition-transform duration-300 px-10 py-5 text-xl"
            >
              Buy New Tires
            </a>
          </div>

          <!-- Audio Player (New Feature, Styled consistently) -->
          <div class="mt-8 pt-8 border-t border-gray-100">
            <p
              class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-3"
            >
              Message from our team
            </p>
            <audio controls class="w-full max-w-xs h-10 rounded-lg">
              <source
                src={`/audio/welcome-${cityName.toLowerCase().replace(" ", "-")}.mp3`}
                type="audio/mpeg"
              />
              Your browser does not support audio.
            </audio>
          </div>
        </div>

        <!-- Right: Image (Truck Proof) -->
        <div class="relative order-1 lg:order-2">
          <div
            class="relative rounded-3xl overflow-hidden shadow-2xl aspect-[4/3] group"
          >
            <div
              class="absolute inset-0 bg-gradient-to-tr from-queens-secondary/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 z-10"
            >
            </div>
            {
              acf.image1?.node?.sourceUrl ? (
                <img
                  src={acf.image1.node.sourceUrl}
                  alt={`Queens Mobile Tires van in ${cityName}`}
                  class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-700"
                />
              ) : (
                <div class="w-full h-full bg-gray-100 flex items-center justify-center">
                  <span class="text-gray-400">
                    queens-van-in-{cityName.toLowerCase()}.jpg
                  </span>
                </div>
              )
            }
            <!-- Caption Overlay -->
            <div
              class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-queens-primary/90 to-transparent p-6 pt-20"
            >
              <p class="text-white text-sm font-medium">
                Our mobile tire shop in {cityName}
              </p>
            </div>
          </div>
          <!-- Decorative Blobs -->
          <div
            class="absolute -top-20 -right-20 w-72 h-72 bg-queens-secondary/10 rounded-full blur-3xl -z-10"
          >
          </div>
          <div
            class="absolute -bottom-20 -left-20 w-72 h-72 bg-queens-light/20 rounded-full blur-3xl -z-10"
          >
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- SERVICES GRID: New Content, Matching Design System -->
  <section class="py-20 bg-gray-50">
    <div class="container mx-auto px-6 max-w-7xl">
      <div class="text-center mb-16">
        <h2 class="text-3xl md:text-4xl font-bold text-queens-primary mb-4">
          We Bring the Shop to You
        </h2>
        <p class="text-lg text-gray-600">
          Full-service tire care at your home or office in {cityName}.
        </p>
      </div>

      <div class="grid md:grid-cols-3 gap-8">
        <!-- Service 1 -->
        <div
          class="bg-white p-8 rounded-3xl shadow-sm hover:shadow-xl transition-all duration-300 border border-gray-100 group"
        >
          <div
            class="w-14 h-14 bg-queens-secondary/10 rounded-2xl flex items-center justify-center mb-6 px-1"
          >
            <!-- Icon: Tire/Wheel -->
            <span class="text-2xl">üõû</span>
          </div>
          <h3 class="text-xl font-bold text-queens-primary mb-3">
            New Tire Installation
          </h3>
          <p class="text-gray-600 leading-relaxed">
            We bring & mount any brand ‚Äî Michelin, Goodyear, Continental ‚Äî right
            at your location.
          </p>
        </div>

        <!-- Service 2 -->
        <div
          class="bg-white p-8 rounded-3xl shadow-sm hover:shadow-xl transition-all duration-300 border border-gray-100 group"
        >
          <div
            class="w-14 h-14 bg-queens-secondary/10 rounded-2xl flex items-center justify-center mb-6 px-1"
          >
            <!-- Icon: Wrench -->
            <span class="text-2xl">üîß</span>
          </div>
          <h3 class="text-xl font-bold text-queens-primary mb-3">
            Flat Tire Repair
          </h3>
          <p class="text-gray-600 leading-relaxed">
            Patch or plug in under 30 minutes. No tow needed, we come to you to
            get you rolling.
          </p>
        </div>

        <!-- Service 3 -->
        <div
          class="bg-white p-8 rounded-3xl shadow-sm hover:shadow-xl transition-all duration-300 border border-gray-100 group"
        >
          <div
            class="w-14 h-14 bg-queens-secondary/10 rounded-2xl flex items-center justify-center mb-6 px-1"
          >
            <!-- Icon: Calendar/Swap -->
            <span class="text-2xl">‚ùÑÔ∏è</span>
          </div>
          <h3 class="text-xl font-bold text-queens-primary mb-3">
            Seasonal Swaps
          </h3>
          <p class="text-gray-600 leading-relaxed">
            Winter to summer changeovers at your house. We can even store your
            off-season tires.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- LOCAL RELEVANCE + REVIEWS (Content Enhancement) -->
  <div class="container mx-auto px-6 py-20 max-w-7xl">
    <div class="grid lg:grid-cols-12 gap-12 lg:gap-16">
      <!-- Left: About Content (Existing + Enhanced) -->
      <div class="lg:col-span-7">
        <h2 class="text-3xl font-bold mb-8 text-queens-primary">
          We Know {cityName}
        </h2>
        <div
          class="prose prose-lg prose-headings:text-queens-primary prose-a:text-queens-secondary text-gray-600 mb-12"
        >
          <!-- CMS Content -->
          <div set:html={acf.localAttractions} />
        </div>

        <!-- FAQ Accordion (New) -->
        <div class="mt-12">
          <h3 class="text-2xl font-bold text-queens-primary mb-6">
            Frequently Asked Questions
          </h3>
          <div class="space-y-4">
            <details
              class="group bg-gray-50 rounded-2xl border border-gray-100 overflow-hidden"
            >
              <summary
                class="flex justify-between items-center font-medium cursor-pointer p-5 text-queens-primary hover:bg-white transition"
              >
                <span>How fast can you reach me in {cityName}?</span>
                <span
                  class="transition group-open:rotate-180 text-queens-secondary"
                  >‚ñº</span
                >
              </summary>
              <div class="p-5 pt-0 text-gray-600 bg-white">
                Most {cityName} customers see us in under 60 minutes ‚Äî often faster
                if you‚Äôre near major roads.
              </div>
            </details>
            <details
              class="group bg-gray-50 rounded-2xl border border-gray-100 overflow-hidden"
            >
              <summary
                class="flex justify-between items-center font-medium cursor-pointer p-5 text-queens-primary hover:bg-white transition"
              >
                <span>Do you service apartment complexes?</span>
                <span
                  class="transition group-open:rotate-180 text-queens-secondary"
                  >‚ñº</span
                >
              </summary>
              <div class="p-5 pt-0 text-gray-600 bg-white">
                Yes! We work in every parking lot in {cityName} ‚Äî apartments, office
                parks, and driveways.
              </div>
            </details>
          </div>
        </div>
      </div>

      <!-- Right: Reviews Column (New) -->
      <div class="lg:col-span-5 space-y-8">
        <CityReviews cityName={cityName} />

        <!-- Image 2 (If available) -->
        {
          acf.image2?.node?.sourceUrl && (
            <div class="rounded-3xl overflow-hidden shadow-lg aspect-video">
              <img
                src={acf.image2.node.sourceUrl}
                class="w-full h-full object-cover"
                alt={`More views of ${cityName}`}
              />
            </div>
          )
        }
      </div>
    </div>
  </div>

  <!-- FINAL CTA: Simple & Bold -->
  <CityCTA headline={`Ready to Get Rolling in ${cityName}?`} />
</BaseLayout>
